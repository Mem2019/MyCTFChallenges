The challenge implements a Naive Bayes algorithm with varying max number of volcabulary for words and labels. When providing a `x` to training, max number of volcabulary will be adjusted to `x + 1`. Such count will be used as vector length. However, when `x == (size_t)(-1u)`, `x + 1` will overflow to 0, which causes integer overflow and making the vector length to be 0. Thus, `-1` index is used to increment size field in chunk header.
The idea is to use this bug to extend chunk size to make it overlap with the next chunk. Then the chunk is freed and allocated again, the next chunk being overlapped will become an unsorted bin.
We can firstly leak libc address using this primitive by putting content of any counter vector as the next chunk to be overlapped. Then we show the corresponding model, so we can leak the address as a counter.
Secondly, we can put a `NaiveBayes` instance as the next chunk. We make it an unsorted bin and allocate it again, so that there will be 2 models that share the same address. We can do double free here, so we can use tcache poisoning to write `__free_hook` in normal way. The `fd` field in chunk is `alpha` field in instance which we can control, so tcache poisoning is easy. We also need to bypass the tcache double free check by increment the second field by 1, which is counter of total number of training data, and this can be easily done by training one more data on the freed instance.